import java.nio.file.Paths

tasks.create("snapPrepare") {
    dependsOn("fatJar")
    // Delete duplicate jar so it won't get packaged
    doLast {
        delete(Paths.get("build", "libs", "timecard-kt.jar"))
    }
}

tasks.create("snapBuild") {
    // Don't need to depend on snapPrepare - snapcraft will clone this repo and run snapPrepare
    doLast {
        copy {
            from rootProject.file("snapcraft.yaml")
            into rootProject.file("snapcraft.yaml.orig")
        }
        exec {
            workingDir rootProject.file("deploy/snap")
			commandLine "python", "version_setter.py"
        }
        exec {
            commandLine "bash", "-c" "snapcraft"
        }
        copy {
            from rootProject.file("snapcraft.yaml.orig")
            into rootProject.file("snapcraft.yaml")
        }
        delete("snapcraft.yaml")
    }
}